Blueprint Avanzato: Creazione del Modulo Magazzino Unificato
Obiettivo: Trasformare la sezione "Magazzino" in un modulo dedicato con una propria dashboard e navigazione interna, separando la gestione delle Attrezzature da quella dei Materiali e unificando le Assegnazioni. Il modulo sar√† controllato da un unico permesso.

üß± Fase 1: Riorganizzare l'Interfaccia Utente (apps/gestionale)
Questa √® la fase pi√π importante. Creiamo la nuova "cornice" per l'intero modulo Magazzino prima di riempirla con i contenuti.

1.1: Creare la Nuova Sidebar del Magazzino
Questa sar√† la navigazione interna del modulo.

Azione: Crea un nuovo file: apps/gestionale/src/components/MagazzinoSidebar.jsx.

Codice:

JavaScript

// apps/gestionale/src/components/MagazzinoSidebar.jsx
import React from 'react';
import { useTheme } from '../ThemeCustomizer';
import { ArrowLeftIcon, WrenchScrewdriverIcon, CubeIcon, ClipboardDocumentListIcon } from '@heroicons/react/24/solid';

export const MagazzinoSidebar = ({ activeSubView, onNavigate, onBack }) => {
    const theme = useTheme();
    if (!theme?.colorClasses) return <aside className="w-64 bg-gray-800" />;

    const activeClass = `${theme.colorClasses[theme.primaryColor].bg} text-white`;
    const inactiveClass = `text-gray-300 hover:bg-gray-700 hover:text-white`;

    const menuItems = [
        { key: 'attrezzature', label: 'Attrezzature', icon: WrenchScrewdriverIcon },
        { key: 'materiali', label: 'Materiali', icon: CubeIcon },
        { key: 'assegnazioni', label: 'Assegnazioni', icon: ClipboardDocumentListIcon },
    ];

    return (
        <aside className="w-64 bg-gray-800 text-white flex flex-col p-4">
            <h1 className="text-xl font-bold text-center mb-6">Magazzino</h1>
            <button onClick={onBack} className="flex items-center w-full p-3 rounded-md text-gray-300 hover:bg-gray-700 mb-6">
                <ArrowLeftIcon className="h-5 w-5 mr-3" />
                <span>Dashboard Principale</span>
            </button>
            <nav className="flex-grow space-y-2">
                {menuItems.map((item) => (
                    <button key={item.key} onClick={() => onNavigate(item.key)} className={`flex items-center w-full p-3 rounded-md ${activeSubView === item.key ? activeClass : inactiveClass}`}>
                        <item.icon className="h-5 w-5 mr-3" />
                        <span className="font-medium">{item.label}</span>
                    </button>
                ))}
            </nav>
        </aside>
    );
};
1.2: Creare il Layout Principale del Modulo Magazzino
Questo sar√† il nuovo componente "contenitore" che ospiter√† la sidebar e le diverse viste del magazzino.

Azione: Crea un nuovo file: apps/gestionale/src/MagazzinoDashboardLayout.jsx.

Codice:

JavaScript

// apps/gestionale/src/MagazzinoDashboardLayout.jsx
import React, { useState } from 'react';
import { MagazzinoSidebar } from './components/MagazzinoSidebar.jsx';
// Importa qui le viste che creeremo/sposteremo nei prossimi passaggi
// Esempio: import { AttrezzatureView } from './AttrezzatureView.jsx';

export const MagazzinoDashboardLayout = ({ onBack }) => {
    const [subView, setSubView] = useState('attrezzature'); // Vista di default

    const renderSubView = () => {
        switch (subView) {
            case 'attrezzature':
                // Qui renderizzeremo il vecchio MagazzinoContent, ora rinominato
                return <div className="p-8">Vista Attrezzature (da implementare)</div>;
            case 'materiali':
                // Placeholder come richiesto
                return <div className="p-8"><h1 className="text-2xl font-bold">Gestione Materiali</h1><p>Questa sezione √® in fase di sviluppo.</p></div>;
            case 'assegnazioni':
                // Qui renderizzeremo la logica di AssegnazioniContentMagazzino
                return <div className="p-8">Vista Assegnazioni (da implementare)</div>;
            default:
                return <div>Seleziona una vista</div>;
        }
    };

    return (
        <div className="flex h-screen">
            <MagazzinoSidebar activeSubView={subView} onNavigate={setSubView} onBack={onBack} />
            <main className="flex-1 overflow-y-auto bg-gray-100">
                {renderSubView()}
            </main>
        </div>
    );
};
1.3: Aggiornare MainContent.jsx per Usare il Nuovo Layout
Modifichiamo il router principale per "collegare" il nostro nuovo modulo.

Azione: Modifica il file apps/gestionale/src/MainContent.jsx.

Codice da modificare:

JavaScript

// apps/gestionale/src/MainContent.jsx

// 1. Importa il nuovo layout
import { MagazzinoDashboardLayout } from './MagazzinoDashboardLayout.jsx'; 
// 2. Rimuovi l'import di 'MagazzinoContent'

// ...

const renderContent = () => {
    switch (activeView) {
        // ... (altri case)

        // 3. Modifica il case 'magazzino'
        case 'magazzino':
            return <MagazzinoDashboardLayout onBack={() => onNavigate('dashboard')} />;

        // ... (altri case)
    }
};
‚öôÔ∏è Fase 2: Adattare i Componenti Esistenti alla Nuova Struttura
Ora riutilizziamo i componenti che hai gi√† costruito, dandogli una nuova casa.

2.1: Trasformare MagazzinoContent.jsx in AttrezzatureView.jsx
Il tuo attuale MagazzinoContent diventer√† la vista dedicata solo alle attrezzature.

Azione: Rinomina il file apps/gestionale/src/MagazzinoContent.jsx in apps/gestionale/src/AttrezzatureView.jsx.

Da fare: Apri il file rinominato e assicurati che contenga solo la logica e la UI per la gestione dell'inventario (le viste GestioneMagazzinoView, GestioneGuastiView, AggiungiArticoloForm, etc.). Il suo ruolo non cambia molto, ma ora vive all'interno del MagazzinoDashboardLayout.

2.2: Creare la Vista AssegnazioniView.jsx
Questo nuovo componente orchestrer√† tutta la logica delle assegnazioni.

Azione: Crea il file apps/gestionale/src/AssegnazioniView.jsx.

Da fare: Sposta la logica e il rendering che avevi nel tuo AssegnazioniContentMagazzino.jsx all'interno di questo nuovo file. Questo componente importer√† useAssegnazioniManager e i componenti UI da shared-ui per gestire il flusso delle assegnazioni.

2.3: Integrare le Viste nel MagazzinoDashboardLayout.jsx

Azione: Torna a apps/gestionale/src/MagazzinoDashboardLayout.jsx e sostituisci i placeholder.

Codice da modificare:

JavaScript

// apps/gestionale/src/MagazzinoDashboardLayout.jsx
import { AttrezzatureView } from './AttrezzatureView.jsx'; // Importa la vista
import { AssegnazioniView } from './AssegnazioniView.jsx'; // Importa la vista

// ...

const renderSubView = () => {
    switch (subView) {
        case 'attrezzature':
            return <AttrezzatureView />;
        case 'materiali':
            return <div className="p-8">...</div>;
        case 'assegnazioni':
            return <AssegnazioniView />;
        // ...
    }
};
üîê Fase 3: Semplificare e Applicare i Permessi
Con questa nuova struttura, la gestione dei permessi diventa ancora pi√π semplice.

3.1: Aggiornare la Definizione delle Funzionalit√†

Azione: Modifica packages/shared-core/src/data/features.js.

Codice Aggiornato: Riduciamo a un solo permesso per l'intero modulo.

JavaScript

export const ALL_FEATURES = [
    { id: 'magazzino', name: 'Modulo Magazzino', description: 'Accesso completo alla gestione di attrezzature, materiali e assegnazioni.' },
    // ... altre funzionalit√† come 'agenda'
];
3.2: Proteggere l'Accesso al Modulo

Azione: Apri apps/gestionale/src/Sidebar.jsx (la sidebar principale).

Da fare: Assicurati che la voce di menu "Magazzino" sia visibile solo se la feature √® abilitata.

JavaScript

// In Sidebar.jsx
const { companyFeatures } = useFirebaseData();
// ...
{companyFeatures?.magazzino && (
    <MenuItem onClick={() => onNavigate('magazzino')}>Magazzino</MenuItem>
)}
Questo blueprint ti fornisce una strada chiara per evolvere la tua applicazione. Una volta completata questa fase, avrai un modulo Magazzino robusto, scalabile e perfettamente integrato con la tua architettura.